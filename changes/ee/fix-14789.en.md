Fix Pulsar producer inflight state leak.

Prior to this fix, Pulsar client's inflight state may sometimes leak, cause the connector's inflight counter never go back to zero.
This fix also included a performance improvement for Pulsar and Kafka producers on x86.
